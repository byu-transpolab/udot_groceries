<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="keywords" content="Accessibility, Access to nutrition, Passive location data">

<title>Equitable Access to Nutrition in Utah - 4&nbsp; Results</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05_scenarios.html" rel="next">
<link href="./03_methods.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04_estimation.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Results</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Equitable Access to Nutrition in Utah</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_litreview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Literature Review</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_estimation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Results</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_scenarios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Application</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Conclusions and Recommendations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acknowledgments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-nems" id="toc-sec-nems" class="nav-link active" data-scroll-target="#sec-nems"><span class="header-section-number">4.1</span> Nutrition Environment</a></li>
  <li><a href="#sec-estimation" id="toc-sec-estimation" class="nav-link" data-scroll-target="#sec-estimation"><span class="header-section-number">4.2</span> Destination Choice</a></li>
  <li><a href="#sec-access" id="toc-sec-access" class="nav-link" data-scroll-target="#sec-access"><span class="header-section-number">4.3</span> Accessibility</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-results" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Results</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This section presents results on the nutrition environment in each of the three communities of Utah County, West Salt Lake County, and San Juan County, along with destination choice model estimates and their application to creating accessibility maps of each community and the entire state of Utah.</p>
<section id="sec-nems" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-nems"><span class="header-section-number">4.1</span> Nutrition Environment</h2>
<div class="cell" data-hash="04_estimation_cache/html/loadnems_0554919ee5a7703d297a1225f71f225c">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(nems_groceries)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>nems_groceries <span class="ot">&lt;-</span> nems_groceries <span class="sc">|&gt;</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">ifelse</span>(type <span class="sc">==</span> <span class="st">"Trading Post"</span>, <span class="st">"Other"</span>, type),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">inflation =</span> <span class="fu">ifelse</span>(county <span class="sc">==</span> <span class="st">"Utah"</span>, market <span class="sc">*</span> <span class="fl">1.094</span>, market),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">county =</span> <span class="fu">factor</span>(county, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Utah"</span>, <span class="st">"Salt Lake"</span>, <span class="st">"San Juan"</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Though some basic descriptive statistics of the grocery store attributes were presented in <a href="03_methods.html#tbl-nems">Table&nbsp;<span>3.2</span></a>, some additional exploration of these attributes is valuable to understand the nutrition environment in these three communities.</p>
<div class="cell" data-hash="04_estimation_cache/html/fig-nems-market-avail_ab4ad8af6e2a379e4d292c713bb309d8">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nems_groceries, <span class="fu">aes</span>(<span class="at">x =</span> availability, <span class="at">y =</span> market, <span class="at">group =</span> county)) <span class="sc">+</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> type)) <span class="sc">+</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>county) <span class="sc">+</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"NEMS Availability Score"</span>)  <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Market Basket Cost [$]"</span>) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Store Type"</span>, <span class="at">values =</span> wesanderson<span class="sc">::</span><span class="fu">wes_palette</span>(<span class="st">'Darjeeling1'</span>)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-nems-market-avail" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="04_estimation_files/figure-html/fig-nems-market-avail-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.1: Relationship between NEMS availability score and market basket score in each study community. Utah county prices adjusted for 2021-2022 annual inflation.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-nems-market-avail">Figure&nbsp;<span>4.1</span></a> presents the relationship between the recorded NEMS availability score and the USDA market basket cost at the stores by community and store type. In all three communities, the relationship is strongly negative, with stores that stock more varieties of goods also having overall lower prices for those goods. This is emphasized by the bottom-right quadrants of these plots (high availability, low-cost) being dominated by full-service grocery stores, which have more availability and lower prices than convenience stores or dollar stores, but require higher traffic and demand to make up for their lower profit margins. Average prices in Utah County are lower than prices in the other two communities across the availability spectrum; this is true even after adjusting for 9.4% annual inflation between March 2021 and March 2022 in food products <span class="citation" data-cites="bureauoflaborstatistics2023">(<a href="references.html#ref-bureauoflaborstatistics2023" role="doc-biblioref">Bureau of Labor Statistics, 2023</a>)</span>.</p>
<div class="cell" data-hash="04_estimation_cache/html/fig-nems-cost-avail_ccd8e7200b0db82873c4e3c6c899c45b">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nems_groceries, <span class="fu">aes</span>(<span class="at">x =</span> availability, <span class="at">y =</span> cost)) <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> type)) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>county) <span class="sc">+</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"NEMS Availability Score"</span>)  <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"NEMS Cost Score"</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Store Type"</span>, <span class="at">values =</span> wesanderson<span class="sc">::</span><span class="fu">wes_palette</span>(<span class="st">'Darjeeling1'</span>)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-nems-cost-avail" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="04_estimation_files/figure-html/fig-nems-cost-avail-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4.2: Relationship between NEMS availability score and cost score in each study community.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-nems-cost-avail">Figure&nbsp;<span>4.2</span></a> shows the relationship between the NEMS availability and cost scores. In this case the relationship is generally positive, with stores that stock more healthful options also placing these options at competitive prices. Conversely, stores with fewer options tend to place the options they do stock at a higher price point. This relationship between availability and cost of healthful goods is strongest in San Juan County, with convenience stores anchoring the low-availability, high-premium quadrant for healthy food. It should be noted that these convenience stores also exist in the Utah County community, but we explicitly included them in the San Juan data collection as they are the only food markets of any kind in multiple towns, with dozens of miles separating towns from each other.</p>
</section>
<section id="sec-estimation" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-estimation"><span class="header-section-number">4.2</span> Destination Choice</h2>
<p>Using the data collected and MNL destination choice model as described in <a href="03_methods.html"><span>Chapter&nbsp;3</span></a>, we estimate a series of model specifications in each community with the <code>mlogit</code> package for R <span class="citation" data-cites="mlogit">(<a href="references.html#ref-mlogit" role="doc-biblioref">Croissant, 2020</a>)</span>. To illustrate the role of different data elements on destination choice, we develop and estimate four different utility equations: <span class="math display">\begin{align*}
\mathrm{Access} &amp;= \beta_{MCLS}( k_{ij})\\
\mathrm{NEMS} &amp;= \beta_{n-a} (\mathrm{NEMS-Availability}) + \beta_{n-c}\mathrm({NEMS-Cost})\\
\mathrm{Attributes} &amp;= \beta_{mkt} (\mathrm{Market Basket}) + \mathbf{\beta}_{type}(\mathrm{Type})\\
\mathrm{All} &amp;= \mathrm{Access} + \mathrm{NEMS} + \mathrm{Attributes}\\
\end{align*}</span> The Access model includes only the mode choice logsum described in <a href="03_methods.html#eq-mcls">Equation&nbsp;<span>3.4</span></a>. The NEMS model includes the NEMS cost and availability scores describing the goods the store offers, while the Attributes model contains information that might be more conventionally available to shoppers including the size, type, and average prices at the store. As the nutrition environment in each community contains different types of stores, the specific type coefficients differ by community. The All model contains all of the other three sets of estimated coefficients.</p>
<div class="cell" data-hash="04_estimation_cache/html/loadmodels_b148256b0d6a5792f456f8845b9ee47d">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(sl_models)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(ut_models)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(sj_models)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="04_estimation_cache/html/tbl-utah-models_cd7b5bda6174407b23aaa211ebe5dbeb">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(ut_models, <span class="at">gof_map =</span> gm, <span class="at">coef_map =</span> cm, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> <span class="fl">0.05</span>, <span class="st">'**'</span> <span class="ot">=</span> <span class="fl">0.01</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">statistic =</span> <span class="st">"({statistic})"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">notes =</span> <span class="fu">list</span>(<span class="st">"t-statistics in parentheses"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-utah-models" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;4.1: Estimated Models of Utah County</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Access</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">NEMS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Attributes</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">All</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mode Choice Log-sum</td>
<td style="text-align: center;">8.090**</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">8.592**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(95.354)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(87.875)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NEMS Availability Score</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.034**</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−0.010**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(23.136)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(−3.191)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NEMS Cost Score</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.029**</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.035**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(6.344)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(5.075)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USDA Market Basket</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−0.007**</td>
<td style="text-align: center;">−0.008**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(−8.943)</td>
<td style="text-align: center;">(−8.756)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Registers</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.057**</td>
<td style="text-align: center;">0.062**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(55.241)</td>
<td style="text-align: center;">(39.579)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Store Type: Dollar Store</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1.955**</td>
<td style="text-align: center;">2.136**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(57.226)</td>
<td style="text-align: center;">(41.639)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Store Type: Convenience Store</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−1.637**</td>
<td style="text-align: center;">−1.769**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(−7.256)</td>
<td style="text-align: center;">(−7.351)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Store Type: Other</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−1.604**</td>
<td style="text-align: center;">−1.560**</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(−12.267)</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(−11.076)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AIC</td>
<td style="text-align: center;">31,798.55</td>
<td style="text-align: center;">49,021.43</td>
<td style="text-align: center;">42,045.1</td>
<td style="text-align: center;">25,587.52</td>
</tr>
<tr class="even">
<td style="text-align: left;">$\rho^2_0$</td>
<td style="text-align: center;">0.36</td>
<td style="text-align: center;">0.014</td>
<td style="text-align: center;">0.154</td>
<td style="text-align: center;">0.485</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> * p &lt; 0.05, ** p &lt; 0.01</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup></sup> t-statistics in parentheses</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>
</div>


</div>
</div>
<p><a href="#tbl-utah-models">Table&nbsp;<span>4.1</span></a> presents the estimated coefficients in the Utah County community. In general, the utility coefficients are statistically significant and in a direction that would be expected by informed hypothesis. The Access model has a positive coefficient on its mode choice log-sum term, which indicates that as the mode choice logsum between a block group and a store increases — indicating lower travel costs between Census block groups and the store, because travel times in <a href="03_methods.html#eq-mcls">Equation&nbsp;<span>3.4</span></a> have a negative relationship with utility — a higher proportion of mobile devices residing in that block group are observed to travel to that store. The NEMS model shows a positive relationship between both environment variables and utility, indicating that people are more likely to choose stores with higher availability of healthy goods and more advantagous prices for those goods, all else equal. The Attributes model suggests that<br>
people are less willing to visit stores with higher prices, fewer registers, and convenience stores or other non-standard grocery stores with the exception of dollar stores, which they are <em>more</em> attracted to. Combining all of these variables in the All model retain the significance, direction, and basic scale of all previous estimates with the exception of the NEMS availability variable. In this case, it seems that the previous positive relationship may have been a result of correlation between NEMS availability and other variables such as cost or the number of registers. And when controlling for all other variables, the role of transportation access becomes somewhat more important than considering only distance alone, implying that people are willing to travel somewhat further for stores with attributes they value.</p>
<p>The overall fit of the four models in <a href="#tbl-utah-models">Table&nbsp;<span>4.1</span></a> is also revealing: the model with only NEMS variables against almost no predictive power over randomly selecting any store in the community (as revealed by the <span class="math inline">\rho_0^2</span> statistic). Though all sets of variables contribute to the overall fit, it is apparent that the bulk of model explanatory power is due to transportation proximity.</p>
<div class="cell" data-hash="04_estimation_cache/html/tbl-sl-models_939cb05d71e35b16fcc1b2634ebd9cbd">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(sl_models, <span class="at">gof_map =</span> gm, <span class="at">coef_map =</span> cm,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> <span class="fl">0.05</span>, <span class="st">'**'</span> <span class="ot">=</span> <span class="fl">0.01</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">statistic =</span> <span class="st">"({statistic})"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">notes =</span> <span class="fu">list</span>(<span class="st">"t-statistics in parentheses"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-sl-models" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;4.2: Estimated Models of West Salt Lake Valley</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Access</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">NEMS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Attributes</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">All</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mode Choice Log-sum</td>
<td style="text-align: center;">9.767**</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">11.924**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(73.003)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(73.366)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NEMS Availability Score</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.135**</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.010**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(73.114)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(2.627)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NEMS Cost Score</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−0.039**</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.049**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(−8.534)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(8.223)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USDA Market Basket</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−0.009**</td>
<td style="text-align: center;">−0.006**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(−12.442)</td>
<td style="text-align: center;">(−6.686)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Registers</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.106**</td>
<td style="text-align: center;">0.128**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(71.242)</td>
<td style="text-align: center;">(51.661)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Store Type: Dollar Store</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.301**</td>
<td style="text-align: center;">0.530**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(6.618)</td>
<td style="text-align: center;">(9.354)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Store Type: Other</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−0.024</td>
<td style="text-align: center;">0.320*</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(−0.184)</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(2.323)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AIC</td>
<td style="text-align: center;">43,025.99</td>
<td style="text-align: center;">42,037.02</td>
<td style="text-align: center;">39,775.88</td>
<td style="text-align: center;">31,636.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">$\rho^2_0$</td>
<td style="text-align: center;">0.134</td>
<td style="text-align: center;">0.154</td>
<td style="text-align: center;">0.2</td>
<td style="text-align: center;">0.364</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> * p &lt; 0.05, ** p &lt; 0.01</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup></sup> t-statistics in parentheses</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>
</div>


</div>
</div>
<div class="cell" data-hash="04_estimation_cache/html/tbl-sj-models_129f74f757d14d82922267a0d402c290">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(sj_models, <span class="at">gof_map =</span> gm, <span class="at">coef_map =</span> cm,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">'*'</span> <span class="ot">=</span> <span class="fl">0.05</span>, <span class="st">'**'</span> <span class="ot">=</span> <span class="fl">0.01</span>),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">statistic =</span> <span class="st">"({statistic})"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">notes =</span> <span class="fu">list</span>(<span class="st">"t-statistics in parentheses"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-sj-models" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;4.3: Estimated Models of San Juan County</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Access</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">NEMS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Attributes</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">All</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mode Choice Log-sum</td>
<td style="text-align: center;">0.732**</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1.233**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(83.411)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(74.178)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NEMS Availability Score</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.134**</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.049**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(61.893)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(10.191)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NEMS Cost Score</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.249**</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.072**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(38.689)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(8.690)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USDA Market Basket</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−0.010**</td>
<td style="text-align: center;">−0.031**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(−13.568)</td>
<td style="text-align: center;">(−23.484)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Registers</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.022**</td>
<td style="text-align: center;">0.052**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(20.793)</td>
<td style="text-align: center;">(27.317)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Store Type: Dollar Store</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−2.126**</td>
<td style="text-align: center;">−1.443**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(−47.105)</td>
<td style="text-align: center;">(−20.779)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Store Type: Convenience Store</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−3.720**</td>
<td style="text-align: center;">−1.376**</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(−31.352)</td>
<td style="text-align: center;">(−9.810)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Store Type: Other</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−1.567**</td>
<td style="text-align: center;">−1.574**</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(−29.544)</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(−22.209)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AIC</td>
<td style="text-align: center;">40,351.12</td>
<td style="text-align: center;">35,021.59</td>
<td style="text-align: center;">37,361.16</td>
<td style="text-align: center;">23,143.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">$\rho^2_0$</td>
<td style="text-align: center;">0.188</td>
<td style="text-align: center;">0.295</td>
<td style="text-align: center;">0.248</td>
<td style="text-align: center;">0.535</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> * p &lt; 0.05, ** p &lt; 0.01</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0;"><sup></sup> t-statistics in parentheses</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>
</div>


</div>
</div>
<p><a href="#tbl-sl-models">Table&nbsp;<span>4.2</span></a> presents the estimated coefficients in the west Salt Lake Valley community, and <a href="#tbl-sj-models">Table&nbsp;<span>4.3</span></a> presents the estimated coefficients in San Juan County. The same general story about coefficient direction and hypotheses applies in both of these communities, except in regards to the NEMS variables. In Salt Lake, the NEMS cost score appears negative when estimated alone but becomes positive when other variables are included. In San Juan, these variables are consistently positive. Additionally, the story of model fit is reversed: in both Salt Lake and San Juan, the attributes of the store explain more of the model fit than the transportation impedance term.</p>
<div class="cell" data-hash="04_estimation_cache/html/fig-all-comp_1ca8fde39c47046c657a6710d3424e62">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use a square root transformation, but have it work in both directions.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>absqrt <span class="ot">&lt;-</span> scales<span class="sc">::</span><span class="fu">trans_new</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"absqrt"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x){<span class="fu">sign</span>(x) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(x))},</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x){<span class="fu">sign</span>(x) <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>},</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">extended_breaks</span>(),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">minor_breaks =</span> scales<span class="sc">::</span><span class="fu">regular_minor_breaks</span>(),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> scales<span class="sc">::</span><span class="fu">format_format</span>(),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">domain =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Utah County"</span>      <span class="ot">=</span> ut_models[[<span class="st">"All"</span>]],</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Salt Lake"</span>        <span class="ot">=</span> sl_models[[<span class="st">"All"</span>]],</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"San Juan"</span>         <span class="ot">=</span> sj_models[[<span class="st">"All"</span>]]</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modelplot</span>(<span class="at">coef_map =</span> cm) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans =</span> absqrt, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> wesanderson<span class="sc">::</span><span class="fu">wes_palette</span>(<span class="st">'Darjeeling1'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-all-comp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="04_estimation_files/figure-html/fig-all-comp-1.png" class="img-fluid figure-img" style="width:6in"></p>
<figcaption class="figure-caption">Figure&nbsp;4.3: Comparison of county model coefficient estimates. Absolute square root transformation applied to improve visibility.</figcaption>
</figure>
</div>
</div>
</div>
<p>To better visualize how the preferences in the three communities differ from each other, <a href="#fig-all-comp">Figure&nbsp;<span>4.3</span></a> plots the coefficient estimates from the All model in each community. The mode choice log-sum is strongly significant in all three communities, but it has its smallest value in San Juan County where people often must travel long distances to reach any stores. The highest mode choice log-sum value is in Salt Lake, but this explains a smaller proportion of the model outcomes than the lower value in Utah County; a possible hypothesis for this observation may include the higher density of stores in Salt Lake — attributes are more important when so many stores are close together — paired with the somewhat lower vehicle ownership in that community driving up the coefficient value. Most other estimates are somewhat consistent across counties, with the exception of the NEMS variables discussed previously and the role of dollar stores and other stores in each community.</p>
</section>
<section id="sec-access" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-access"><span class="header-section-number">4.3</span> Accessibility</h2>
<div class="cell" data-hash="04_estimation_cache/html/utbgaccess_8018827c394efdc01e600d2531a24d87">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(utbgaccess)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the models estimated in <a href="#sec-estimation"><span>Section&nbsp;4.2</span></a>, we can evaluate the spatial access of each community. <a href="#fig-map-ut">Figure&nbsp;<span>4.4</span></a> shows the value of the grocery store destination choice log-sum for block groups in Utah County. Unsurprisingly, the block groups in the core of the urban areas of the region have the highest access to grocery stores, because this is where the stores are located and also where the transportation access to multiple destinations is highest. This map also contains somewhat interesting implications for the equity of access. A perhaps unique feature of Utah County’s demographic geography is that the wealthiest neighborhoods tend to be located on the mountain benches east of the main urban areas. This means that in Utah County, at least, the neighborhoods with the lowest access to grocery stores are actually some of the wealthiest neighborhoods with the lowest concentrations of ethnic minorities in the region.</p>
<div class="cell" data-hash="04_estimation_cache/html/fig-map-ut_0a7b07282609ddb992be652edb66ef65">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> wesanderson<span class="sc">::</span><span class="fu">wes_palette</span>(<span class="st">"Zissou1"</span>, <span class="dv">100</span>, <span class="at">type =</span> <span class="st">"continuous"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(utbgaccess, <span class="fu">aes</span>(<span class="at">fill =</span> access)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_map_tile</span>(<span class="st">"cartolight"</span>, <span class="at">zoom =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">lwd =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="st">"Access"</span>, <span class="at">colours =</span> pal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: raster</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,
which was just loaded, will retire in October 2023.
Please refer to R-spatial evolution reports for details, especially
https://r-spatial.org/r/2023/05/15/evolution4.html.
It may be desirable to make the sf package available;
package maintainers should consider adding sf to Suggests:.
The sp package is now running under evolution status 2
     (status 2 uses the sf package in place of rgdal)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Please note that rgdal will be retired during October 2023,
plan transition to sf/stars/terra functions using GDAL and PROJ
at your earliest convenience.
See https://r-spatial.org/r/2023/05/15/evolution4.html and https://github.com/r-spatial/evolution
rgdal: version: 1.6-7, (SVN revision 1203)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 3.5.3, released 2022/10/21
Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/rgdal/gdal
 GDAL does not use iconv for recoding strings.
GDAL binary built with GEOS: TRUE 
Loaded PROJ runtime: Rel. 9.1.0, September 1st, 2022, [PJ_VERSION: 910]
Path to PROJ shared files: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/rgdal/proj
PROJ CDN enabled: FALSE
Linking to sp version:1.6-1
To mute warnings of possible GDAL/OSR exportToProj4() degradation,
use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Zoom: 11</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-map-ut" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="04_estimation_files/figure-html/fig-map-ut-1.png" class="img-fluid figure-img" style="width:6in"></p>
<figcaption class="figure-caption">Figure&nbsp;4.4: Modeled access to grocery stores in Utah County</figcaption>
</figure>
</div>
</div>
</div>
<p>Of course, much of this high access in the urban core of Utah County is achieved by cheap and available automobile transportation. We can consider what access looks like for those without cars by re-computing the mode choice log-sum described in <a href="03_methods.html#sec-mcls"><span>Section&nbsp;3.2.3</span></a> between all block group / store pairs but eliding the automobile mode, and examining the resulting impact to destination choice utility. <a href="#fig-map-nocar">Figure&nbsp;<span>4.5</span></a> shows the results of this analysis: whereas the total access (with car included) is a smooth gradient across the valley, the access for individuals without vehicles is blocky and discontinuous, with neighborhoods of relatively good access immediately next to neighborhoods with bad or non-existent access. This may reflect the discontinuous nature of active transport and public transit facilities in the region, as well as the auto-dominated locations of many grocery stores. Note also that even for neighborhoods of relatively good non-vehicle access, the destination choice log-sum value is substantially lower than the logsum with vehicle access; the minimum value on with vehicles is just below 0, whereas the <em>maximum</em> log-sum without vehicles is around -100. Because the log-sum occurs on the same scale in both cases, this represents a serious additional cost for non-vehicle users.</p>
<div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(nocaraccess)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nocaraccess, <span class="fu">aes</span>(<span class="at">fill =</span> dclogsum)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoom =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">lwd =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">112.11</span>, <span class="sc">-</span><span class="fl">111.7</span>)) <span class="sc">+</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">40.5</span>, <span class="fl">40.8</span>)) <span class="sc">+</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="st">"Access"</span>, <span class="at">colours =</span> pal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Zoom: 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nocaraccess <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(nocarlogsum)), <span class="fu">aes</span>(<span class="at">fill =</span> nocarlogsum)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"cartolight"</span>, <span class="at">zoom =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">lwd =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">112.11</span>, <span class="sc">-</span><span class="fl">111.7</span>)) <span class="sc">+</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">40.5</span>, <span class="fl">40.8</span>)) <span class="sc">+</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="st">"Access"</span>, <span class="at">colours =</span> pal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Zoom: 12</code></pre>
</div>
<div id="fig-map-nocar" class="cell quarto-layout-panel" data-hash="04_estimation_cache/html/fig-map-nocar_c251af9e3b5a7ee5dc8013d47f3f44ab">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-map-nocar-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="04_estimation_files/figure-html/fig-map-nocar-1.png" class="img-fluid figure-img" style="width:4in" data-ref-parent="fig-map-nocar"></p>
<figcaption class="figure-caption">(a) With vehicles</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-map-nocar-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="04_estimation_files/figure-html/fig-map-nocar-2.png" class="img-fluid figure-img" style="width:4in" data-ref-parent="fig-map-nocar"></p>
<figcaption class="figure-caption">(b) Without vehicles</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.5: Access to groceries in Salt Lake County with and without a vehicle.</figcaption><p></p>
</figure>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list" style="display: none">
<div id="ref-bureauoflaborstatistics2023" class="csl-entry" role="listitem">
Bureau of Labor Statistics. (2023). 12-month percentage change, <span>Consumer Price Index</span>, selected categories. In <em>Consumer Price Index</em>. https://www.bls.gov/charts/consumer-price-index/consumer-price-index-by-category-line-chart.htm.
</div>
<div id="ref-mlogit" class="csl-entry" role="listitem">
Croissant, Y. (2020). Estimation of random utility models in <span>R</span>: The <span class="nocase">mlogit</span> package. <em>Journal of Statistical Software</em>, <em>95</em>(11), 1–41. <a href="https://doi.org/10.18637/jss.v095.i11">https://doi.org/10.18637/jss.v095.i11</a>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03_methods.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05_scenarios.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Application</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>